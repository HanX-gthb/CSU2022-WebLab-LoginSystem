<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <form  id="loginForm">
        <label>姓名<input id="uname" type="text" name="uname"></label> <br>
        <label>密码<input id="upwd" type="text" name="upwd"></label><br>
        <button id="login" type="button">登录</button>
        <button id="register" type="button">注册</button>
    </form>

    <script>
        let register = document.getElementById("register")
        register.addEventListener("click", function (e) {
                // Step1 创建请求对象
            let rqst = new XMLHttpRequest();
                // Step2 设置请求对象的请求行/请求头
            let userName = document.getElementById('uname').value;
            let userPwd = document.getElementById('upwd').value;
            const api = "http://localhost:8080/lp/register?"
            let url = api + `uname=${userName}` + `&upwd=${userPwd}`
            rqst.open('GET', url, true);
                // Step3 设置回调函数
            rqst.onreadystatechange = () => {
                if (rqst.readyState === 4 && rqst.status === 200) {
                    const rsps = JSON.parse(rqst.response);
                    console.log(rsps)
                    window.location.href="http://localhost:8080/lp/index.jsp";
                }
            }
                // Step4 发送请求（请求体作为参数, Get方法则为null）
            rqst.send(null)
        })

        let login = document.getElementById("login")
        login.addEventListener("click", function (e) {
            // Step1 创建请求对象
            let rqst = new XMLHttpRequest();
            // Step2 设置请求对象的请求行/请求头
            let userName = document.getElementById('uname').value;
            let userPwd = document.getElementById('upwd').value;
            const api = "http://localhost:8080/lp/login?"
            let url = api + `uname=${userName}` + `&upwd=${userPwd}`
            rqst.open('GET', url, true);
            // Step3 设置回调函数
            rqst.onreadystatechange = () => {
                if (rqst.readyState === 4 && rqst.status === 200) {
                    const rsps = JSON.parse(rqst.response);
                    console.log(rsps);
                    console.log(rsps.code);
                    console.log(rsps.user["userName"]);
                    if(rsps.code === 1 && rsps.user["userName"] === 'admin'){
                        window.location.href="http://localhost:8080/lp/manage.html";
                    }

                }
            }
            // Step4 发送请求（请求体作为参数, Get方法则为null）
            rqst.send(null)
        })
    </script>
</body>


</html>